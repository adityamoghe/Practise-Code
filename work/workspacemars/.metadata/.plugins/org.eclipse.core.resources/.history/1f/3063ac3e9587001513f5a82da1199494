package com.yash.training.tms.bean;

import javax.faces.bean.ManagedBean;
import javax.faces.bean.RequestScoped;
import javax.faces.context.FacesContext;
import javax.inject.Inject;

import java.sql.SQLException;
import java.util.ArrayList;
import java.util.List;

import javax.ejb.EJB;

import com.yash.training.tmp.domain.Designation;
import com.yash.training.tmp.domain.ManagerMenu;
import com.yash.training.tmp.domain.TraineeMenu;
import com.yash.training.tmp.domain.TrainerMenu;
import com.yash.training.tmp.domain.User;
import com.yash.training.tmp.service.UserServiceBeanLocal;

@ManagedBean
@RequestScoped
public class UserBean {
	@EJB
	UserServiceBeanLocal userbeanservice;
	private String userName;
	private String password;
	private String name;
	private String contact;
	private int designation;
	
	private String email;
	List<String> managerMenuList = new ArrayList<String>();
	List<String> trainerMenuList = new ArrayList<String>();
	List<String> traineeMenuList = new ArrayList<String>();
	List<String> listToBePopulated = new ArrayList<>();
	User user = new User();

	public String getUserName() {
		return userName;
	}

	public void setUserName(String userName) {
		this.userName = userName;
	}

	public List<String> getManagerMenuList() {
		return managerMenuList;
	}

	public void setManagerMenuList(List<String> managerMenuList) {
		this.managerMenuList = managerMenuList;
	}

	public List<String> getTrainerMenuList() {
		return trainerMenuList;
	}

	public void setTrainerMenuList(List<String> trainerMenuList) {
		this.trainerMenuList = trainerMenuList;
	}

	public List<String> getTraineeMenuList() {
		return traineeMenuList;
	}

	public void setTraineeMenuList(List<String> traineeMenuList) {
		this.traineeMenuList = traineeMenuList;
	}

	public List<String> getListToBePopulated() {
		return listToBePopulated;
	}

	public void setListToBePopulated(List<String> listToBePopulated) {
		this.listToBePopulated = listToBePopulated;
	}

	public int getDesignation() {
		return designation;
	}

	public void setDesignation(int designation) {
		this.designation = designation;
	}

	public String getName() {
		return name;
	}

	public void setName(String name) {
		this.name = name;
	}

	public String getContact() {
		return contact;
	}

	public void setContact(String contact) {
		this.contact = contact;
	}

	public String getEmail() {
		return email;
	}

	public void setEmail(String email) {
		this.email = email;
	}

	public String getPassword() {
		return password;
	}

	public void setPassword(String password) {
		this.password = password;
	}

	public String LoginAction() throws Exception {
		System.out.println("inside login");
		User user = new User();
		user.setUsername(userName);
		user.setPassword(password);
		System.out.println("login" + user);
		String message = userbeanservice.authencticateUser(user);
		
		
		
		
		
		if (message.equals("success")) {
			
			int d_id=designation;
			System.out.println(d_id);
			setName(user.getUser_name());
			if(d_id==1){
				
			}
			return "welcome";
		} else {
			return "index?err=" + message + " faces-redirect=true";
		}
		// index?err=invalid username or password faces-redirect=true
	}

	
	
	
	public String authenticate() throws SQLException {
		String message = userServiceBeanLocal.authenticate(username, password);
		if (message.equalsIgnoreCase("success")) {
		User user = userServiceBeanLocal.getUserName(username, password);
		int d_id = user.getDesignation_id();
		System.out.println(d_id);
		setName(user.getName());
		if (d_id == 1) {
		populateList.add(managerMenu.getAddTrainingPlan());
		populateList.add(managerMenu.getRemoveTrainer());
		populateList.add(managerMenu.getSeeAllTrainers());
		populateList.add(managerMenu.getTestResult());
		for (String mList : populateList)
		System.out.println("--------------" + mList + "----------------------");

		System.out.println("this is manager");
		} 
		 
		if (d_id == 2) {
		populateList.add(trainerMenu.getPerfomanceSheet());
		populateList.add(trainerMenu.getSeeAllTrainees());
		populateList.add(trainerMenu.getSeeTrainingSchedule());
		populateList.add(trainerMenu.getSetPoc());
		for (String mList : populateList)
		System.out.println("--------------" + mList + "----------------------");

		System.out.println("this is trainer");
		}
		if (d_id == 3) {
		populateList.add(traineeMenu.getApplyForLeave());
		populateList.add(traineeMenu.getSeePocs());
		populateList.add(traineeMenu.getSeeTestResults());
		populateList.add(traineeMenu.getSendFeedback());
		for (String mList : populateList)
		System.out.println("--------------" + mList + "----------------------");

		System.out.println("this is trainee");
		}
		 
		return "welcome";
		} else {
		return "login.xhtml?faces-redirect=true&error=" + message;
		}

		}
		 
		public String logout()
		{
		HttpSession session= (HttpSession)FacesContext.getCurrentInstance().getExternalContext().getSession(false);
		session.invalidate();
		return "login";
		}

		}
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	public String registrationAction() throws Exception {
		System.out.println("inside registration" + designation);
		User user = new User();
		user.setUser_name(name);
		user.setUsername(userName);
		user.setPassword(password);
		user.setUser_email_id(email);
		user.setUser_contact(contact);

		userbeanservice.registerUser(user, designation);
		return "index.xhtml";

	}

	Designation desi = new Designation();
/*
	@Inject
	ManagerMenu managerMenu;
	@Inject
	TrainerMenu trainerMenu;
	@Inject
	TraineeMenu traineeMenu;
*/
	User userAuthenticate(String username, String password) {
		
		
		
		
		int designation_id = user.getDesignation().getUser_designationid();

		if (designation_id == 1) {
			ManagerMenu managerMenu=new ManagerMenu();
			listToBePopulated.add(managerMenu.getAddTrainees());
			listToBePopulated.add(managerMenu.getRemoveTrainer());
			listToBePopulated.add(managerMenu.getSeeTraineeMarks());
			for (String printList: listToBePopulated){
				System.out.println(printList);
			}
		}

		else if (designation_id == 2) {
			TrainerMenu trainerMenu=new TrainerMenu();
			listToBePopulated.add(trainerMenu.getAddTrainees());
			listToBePopulated.add(trainerMenu.getRemoveTrainee());
			listToBePopulated.add(trainerMenu.getSeeTraineeMarks());
			for (String printList: listToBePopulated){
				System.out.println(printList);
			}
		}

		else if (designation_id == 3) {
			TraineeMenu traineeMenu=new TraineeMenu();
			listToBePopulated.add(traineeMenu.getSeeTraineeMarks());
			for (String printList: listToBePopulated){
				System.out.println(printList);
			}
		}

		return user ;

	}

}
